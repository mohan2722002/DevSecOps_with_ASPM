stages:
  - secret_scan
secret_scan:
  stage: secret_scan
  image: zricethezav/gitleaks:latest
  tags:
    - centos
  script:
    - echo "ğŸ” Starting Gitleaks secret scan..."
    - gitleaks detect --source "$CI_PROJECT_DIR" --no-git --report-format json --report-path "$CI_PROJECT_DIR/gitleaks_report.json"
    - echo "ğŸ“„ Checking report:"
    - ls -la "$CI_PROJECT_DIR/gitleaks_report.json" || echo "âŒ Report not found"
  artifacts:
    paths:
      - gitleaks_report.json
    when: always
    expire_in: 1 week
  allow_failure: true