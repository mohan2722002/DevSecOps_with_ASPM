stages:
  - sca

# --- SCA ---
snyk-sca:
  stage: sca
  image: node:18
  script:
  - echo "üîê Authenticating Snyk CLI..."
  - snyk auth $SNYK_TOKEN
  - echo "üîç Running Snyk SCA scan..."
  - snyk test --json > snyk-sca-report.json || echo "‚ö†Ô∏è Vulnerabilities found, but job will continue."

  artifacts:
    paths:
      - snyk-sca-report.json
    reports:
      dependency_scanning: snyk-sca-report.json
  variables:
    SNYK_TOKEN: $SNYK_TOKEN
  only:
    - merge_requests
    - main
