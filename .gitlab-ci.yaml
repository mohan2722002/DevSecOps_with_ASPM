stages:
  - build
  - zap_scan

variables:
  DOCKER_TLS_CERTDIR: ""

before_script:
  - docker info

build:
  stage: build
  tags:
    - centos  # Make sure your local GitLab runner is tagged this way
  script:
    - echo "üöß Building containers using Docker Compose..."
    - docker compose -f .build/docker-compose.yml up -d


zap_scan:
  stage: zap_scan
  tags:
    - centos
  image: owasp/zap2docker-stable
  script:
    - echo "üïµÔ∏è Running ZAP scan on live containers..."
    - zap-baseline.py -t http://host.docker.internal:8888 -r zap_http_report.html
    - zap-baseline.py -t https://host.docker.internal:443 -r zap_https_report.html
  artifacts:
    paths:
      - zap_https_report.html
    when: always
    expire_in: 1 week
