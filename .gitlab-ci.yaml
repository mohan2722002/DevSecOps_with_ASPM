stages:
  - sca_scan

sca_scan:
  stage: sca_scan
image: node:18  # Or any base image with npm support
  tags:
    - centos
  before_script:
    - echo "ðŸ” Authenticating Snyk CLI..."
    - npm install -g snyk
    - snyk auth $SNYK_TOKEN
  script:
    - echo "ðŸ” Using locally installed Snyk CLI..."
    - snyk auth $SNYK_TOKEN
    - snyk test --json > snyk_sca_report.json || echo "âš ï¸ Vulnerabilities found."
    - ls -la snyk_sca_report.json || echo "âŒ Report not generated"
    - echo "ðŸ” Running Snyk SCA scan..."
    - snyk test --json > snyk_sca_report.json || true
    - echo "ðŸ“„ Listing report file:"
    - ls -la snyk_sca_report.json
  artifacts:
    paths:
      - snyk_sca_report.json
    when: always
    expire_in: 1 week
  allow_failure: true
