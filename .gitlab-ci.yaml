stages:
  - secret_scan

secret_scan:
  stage: secret_scan
  image: zricethezav/gitleaks:latest
  tags:
    - centos
  script:
    - echo "ğŸ” Starting Gitleaks secret scan..."
    - gitleaks detect \
        --source . \
        --no-git \
        --report-format json \
        --report-path ./gitleaks_report.json
    - echo "ğŸ“ Contents after scan:"
    - ls -la ./gitleaks_report.json || echo "Report not found"
  artifacts:
    paths:
      - gitleaks_report.json
    when: always
    expire_in: 1 week
  allow_failure: true
